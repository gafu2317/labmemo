# 議論支援システム "Trajectory" 開発計画書

## 概要

LLMとベクトル埋め込みを用いて議論の「軌跡」を可視化し、目的からの逸脱（脱線）をリアルタイムで検出・警告するシステム。

## 利用範囲

* 研究用途（個人利用・対話型実験）
* localhost環境（Streamlit単体動作）

## 目的

議論のゴールに対する「現在のベクトル（方向と距離）」を可視化することで、メタ認知を促し、結論に至るまでの時間短縮と密度向上を図る。

## 主要機能

### 1. 議論軌跡の可視化 (Trajectory Mapping)

* **機能:** 議論のゴールを中心(0,0)とした2次元マップ上に、各発言をプロットする。
* **UX:** 発言が重なるごとに点が増え、議論が迷走すると点が中心から拡散し、収束すると中心に集まる様子を可視化する。

### 2. コンテキスト認識型 脱線検出 (Context-Aware Drift Detection)

* **Logic:**
1. **Semantic Distance:** 発言の埋め込みベクトルと「議論のゴール」とのコサイン類似度を計算。
2. **Relevance Check:** 類似度が低い場合、gpt-4o-miniが「この発言は議論の転換点として有効か、単なるノイズか」を判定。


* **Action:** 無効な脱線と判定された場合、UI上で警告（Alert）を表示し、元の話題への復帰を促す。

## 技術スタック

* **Language:** Python 3.10+
* **Frontend/App:** Streamlit (UIおよびState管理)
* **LLM:** OpenAI API (gpt-4o-mini)
* **Vector Store:** ChromaDB or FAISS (インメモリで動作可能なもの)
* **Embedding:** OpenAI text-embedding-3-small (コストと精度のバランス)
* **Visualization:** Plotly (Streamlit上でインタラクティブな散布図を描画)

## 開発フェーズ

### Phase 1: コアロジック検証 (CLIベース)

* [ ] 模擬議論ログを用いた「脱線」の定義とアノテーション作成
* [ ] Embedding + LLMによる脱線判定精度の検証（F1スコア計測）
* [ ] 判定ロジックの固定（プロンプトエンジニアリング含む）

### Phase 2: プロトタイプ実装 (Streamlit)

* [ ] チャットUIの実装 (`st.chat_message`)
* [ ] リアルタイム埋め込み処理の実装
* [ ] 簡易的な色分け表示（可視化Lv.1）

### Phase 3: 可視化高度化

* [ ] 次元削減または射影ロジックの実装（ベクトル→2次元座標）
* [ ] Plotlyによる「議論マップ」のリアルタイム描画（可視化Lv.2）
* [ ] 脱線アラートUIの実装

### Phase 4: 評価実験

* [ ] 比較実験（システムあり vs なし）での議論時間計測
* [ ] 軌道修正率（アラート後のNターン以内のベクトル復帰率）の算出

## 評価指標（KPI）

1. **脱線検出精度**
* 人手でラベリングした「脱線」に対する適合率（Precision）と再現率（Recall）。特に「必要な寄り道」を誤検知しないかを重視。


2. **軌道修正効果 (Recovery Rate)**
* アラート表示後、3ターン以内に話題ベクトルがゴール方向へ修正された割合。


3. **議論効率 (Token Efficiency)**
* 結論に至るまでに消費した総トークン数（または時間）の削減率。